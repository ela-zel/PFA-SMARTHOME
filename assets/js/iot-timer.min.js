!function(t){function e(t){var e;return t=t||0,e=Math.floor(t/60),{days:t>=r.DAYINSECONDS?Math.floor(t/r.DAYINSECONDS):0,hours:t>=3600?Math.floor(t%r.DAYINSECONDS/3600):0,totalMinutes:e,minutes:t>=60?Math.floor(t%3600/60):e,seconds:t%60,totalSeconds:t}}function n(t){return((t=parseInt(t,10))<10&&"0")+t}function i(){return Math.round((Date.now?Date.now():(new Date).getTime())/1e3)}function o(t){var e,n;return t.indexOf("sec")>0?n=Number(t.replace(/\ssec/g,"")):t.indexOf("min")>0?(e=(t=t.replace(/\smin/g,"")).split(":"),n=Number(60*e[0])+Number(e[1])):t.match(/\d{1,2}:\d{2}:\d{2}:\d{2}/)?(e=t.split(":"),n=Number(e[0]*r.DAYINSECONDS)+Number(3600*e[1])+Number(60*e[2])+Number(e[3])):t.match(/\d{1,2}:\d{2}:\d{2}/)&&(e=t.split(":"),n=Number(3600*e[0])+Number(60*e[1])+Number(e[2])),n}function s(e,n){e.state=n,t(e.element).data("state",n)}function a(e,n){if(this.element=e,this.originalConfig=t.extend({},n),this.totalSeconds=0,this.intervalId=null,this.html="html","INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName||(this.html="val"),this.config=c.getDefaultConfig(),n.duration&&(n.duration=c.durationTimeToSeconds(n.duration)),"string"!=typeof n&&(this.config=t.extend(this.config,n)),this.config.seconds&&(this.totalSeconds=this.config.seconds),this.config.editable&&c.makeEditable(this),this.startTime=c.unixSeconds()-this.totalSeconds,this.config.duration&&this.config.repeat&&this.config.updateFrequency<1e3&&(this.config.updateFrequency=1e3),this.config.countdown){if(!this.config.duration)throw new Error("Countdown option set without duration!");if(this.config.editable)throw new Error("Cannot set editable on a countdown timer!");this.config.startTime=c.unixSeconds()-this.config.duration,this.totalSeconds=this.config.duration}}var r={PLUGIN_NAME:"timer",TIMER_RUNNING:"running",TIMER_PAUSED:"paused",DAYINSECONDS:86400},c={getDefaultConfig:function(){return{seconds:0,editable:!1,duration:null,callback:function(){console.log("Time up!")},repeat:!1,countdown:!1,format:null,updateFrequency:500}},unixSeconds:i,secondsToPrettyTime:function(t){var i=e(t);return i.days?i.days+":"+n(i.hours)+":"+n(i.minutes)+":"+n(i.seconds):i.hours?i.hours+":"+n(i.minutes)+":"+n(i.seconds):i.minutes?i.minutes+":"+n(i.seconds)+" min":i.seconds+" sec"},secondsToFormattedTime:function(t,i){for(var o=e(t),s=[{identifier:"%d",value:o.days},{identifier:"%h",value:o.hours},{identifier:"%m",value:o.minutes},{identifier:"%s",value:o.seconds},{identifier:"%g",value:o.totalMinutes},{identifier:"%t",value:o.totalSeconds},{identifier:"%D",value:n(o.days)},{identifier:"%H",value:n(o.hours)},{identifier:"%M",value:n(o.minutes)},{identifier:"%S",value:n(o.seconds)},{identifier:"%G",value:n(o.totalMinutes)},{identifier:"%T",value:n(o.totalSeconds)}],a=0;a<s.length;a++)i=i.replace(s[a].identifier,s[a].value);return i},durationTimeToSeconds:function(t){if(!isNaN(Number(t)))return t;var e=(t=t.toLowerCase()).match(/\d+d/),n=t.match(/\d+h/),i=t.match(/\d+m/),o=t.match(/\d+s/);if(!(e||n||i||o))throw new Error("Invalid string passed in durationTimeToSeconds!");var s=0;return e&&(s+=Number(e[0].replace("d",""))*r.DAYINSECONDS),n&&(s+=3600*Number(n[0].replace("h",""))),i&&(s+=60*Number(i[0].replace("m",""))),o&&(s+=Number(o[0].replace("s",""))),s},prettyTimeToSeconds:o,setState:s,makeEditable:function(e){t(e.element).on("focus",function(){e.pause()}),t(e.element).on("blur",function(){e.totalSeconds=o(t(e.element)[e.html]()),e.resume()})},intervalHandler:function(e){if(e.totalSeconds=i()-e.startTime,e.config.countdown)return e.totalSeconds=e.config.duration-e.totalSeconds,0===e.totalSeconds&&(clearInterval(e.intervalId),s(e,r.TIMER_STOPPED),e.config.callback(),t(e.element).data("seconds")),void e.render();e.render(),e.config.duration&&e.totalSeconds>0&&e.totalSeconds%e.config.duration==0&&(e.config.callback&&e.config.callback(),e.config.repeat||(clearInterval(e.intervalId),s(e,r.TIMER_STOPPED),e.config.duration=null))}};a.prototype.start=function(){this.state!==r.TIMER_RUNNING&&(c.setState(this,r.TIMER_RUNNING),this.render(),this.intervalId=setInterval(c.intervalHandler.bind(null,this),this.config.updateFrequency))},a.prototype.pause=function(){this.state===r.TIMER_RUNNING&&(c.setState(this,r.TIMER_PAUSED),clearInterval(this.intervalId))},a.prototype.resume=function(){this.state===r.TIMER_PAUSED&&(c.setState(this,r.TIMER_RUNNING),this.config.countdown?this.startTime=c.unixSeconds()-this.config.duration+this.totalSeconds:this.startTime=c.unixSeconds()-this.totalSeconds,this.intervalId=setInterval(c.intervalHandler.bind(null,this),this.config.updateFrequency))},a.prototype.remove=function(){clearInterval(this.intervalId),t(this.element).data(r.PLUGIN_NAME,null),t(this.element).data("seconds",null)},a.prototype.reset=function(){var e=this.originalConfig;this.remove(),t(this.element).timer(e)},a.prototype.render=function(){if(this.config.format)t(this.element)[this.html](c.secondsToFormattedTime(this.totalSeconds,this.config.format));else if(this.config.attribute){if(t(this.element).attr(this.config.attribute,this.totalSeconds),this.config.style){var e=100/parseInt(this.config.duration,10);t(this.element).css(this.config.style,e*this.totalSeconds+this.config.style_unit)}}else t(this.element)[this.html](c.secondsToPrettyTime(this.totalSeconds));t(this.element).data("seconds",this.totalSeconds)},t.fn.timer=function(e){return e=e||"start",this.each(function(){t.data(this,r.PLUGIN_NAME)instanceof a||t.data(this,r.PLUGIN_NAME,new a(this,e));var n=t.data(this,r.PLUGIN_NAME);"string"==typeof e?"function"==typeof n[e]&&n[e]():n.start()})}}(jQuery);